# demoprint

Canon G695용 잉크 6채널(예: C/M/Y/K/Red/Gray) 분리/프리뷰/필름 시뮬레이션 도구입니다. 이미지를 로드해 각 잉크 채널을 분리하고, 원하는 채널을 선택/합성해 확인하거나 개별 PNG로 내보낼 수 있습니다. 분리는 흡수 매트릭스 기반(간이 CMYK+Red/Gray 모델)이며, 재구성 모드에서 원본과 최대한 비슷하게 보여줍니다. 필름을 겹쳐 백라이팅할 상황을 가정한 3D 시뮬레이터를 제공합니다.

> 주의: 이 도구는 이미지 전처리/분석용입니다. 실제 프린터 드라이버의 잉크 사용을 제어하지 않으며, Canon 순정 드라이버를 대체하지 않습니다.

## 설치

```bash
# 홈 디렉터리에 설치
cd ~
git clone https://github.com/GistKjoon/G6-Ink-Studio.git
cd G6-Ink-Studio

# 가상환경 생성 및 활성화
python3 -m venv .venv
source .venv/bin/activate

# 의존성 설치
pip install -r requirements.txt

# 실행
./start.sh
```

> 이미 저장소를 받아두었다면 `cd ~/G6-Ink-Studio && git pull`로 업데이트 후 위의 가상환경/실행 부분만 다시 실행하세요.

## 실행화면

- 첫 화면: 
- 시뮬레이터: 

## 주요 기능

- 이미지 로드 후 6개 잉크 채널(C/M/Y/K/Red/Gray)로 분리
- 각 채널의 강도 미리보기(색상 틴트) 및 체크박스로 합성 미리보기 on/off
- Red 잉크 부스트, Gray(무채색) 강조 슬라이더로 채널 분포 튜닝
- 개별 채널 PNG와 선택된 채널 합성 이미지를 한 번에 저장
- Export 시 6개 채널 PNG는 투명 배경 위에 해당 채널 색만 알파로 담긴 RGBA입니다(필름 겹치기용). 합성 PNG는 흡수 매트릭스로 재구성한 결과(원본 근사)를 저장합니다.
- Calibration UI에서 흡수 매트릭스(3x6)를 편집/적용하고 JSON으로 저장/불러올 수 있습니다.
- Simulator: 광원 색/밝기/위치, 플레이트 간격, 깊이 패럴럭스 조정 후 3D 뷰와 결과 프리뷰를 함께 확인할 수 있습니다. 광원-캔버스 사이에 없는 플레이트는 자동 제외됩니다. Live 토글로 실시간/수동 렌더를 전환할 수 있습니다.

## 사용 흐름

1. `Open Image`로 이미지를 선택합니다. (JPEG/PNG 등 지원)
2. 오른쪽 채널 미리보기에서 각 잉크 채널을 확인하고 필요하면 체크박스로 합성 여부를 조정합니다.
3. `Red Boost`/`Gray Neutral` 슬라이더로 분할 강도를 조정합니다.
4. `Export All`을 눌러 `exports/` 폴더(실행 위치 기준)에 채널별 PNG와 합성본을 저장합니다.

## 잉크 채널 모델링 메모

- `color_model.py`의 `DEFAULT_ABSORBANCE`(3x6 매트릭스)가 각 채널이 R/G/B를 얼마나 흡수하는지 정의합니다. 초기값은 크로스톡을 줄인 직교형 CMY + K/Red/Gray 근사입니다.
- `DEFAULT_PINV`는 역변환(의사역행렬)으로, 선형 RGB → 6채널 → 선형 RGB 순환 시 원본과 최대한 비슷해지도록 구성했습니다.
- 실제 장치에 맞추려면 캘리브레이션이 필요합니다(투명 필름, 백라이팅 조건, 스캐너 측정 등). 측정한 흡수율로 `DEFAULT_ABSORBANCE`를 교체하면 더 정밀한 분리가 가능합니다.
- 합성 모드 “원본과 동일”은 흡수 매트릭스 기반 재구성으로 원본에 근접한 프리뷰를 보여줍니다. “채널 틴트 미리보기”는 단순 틴트 색상 합성입니다.

필요시 `color_model.py`의 매트릭스를 수정하거나 UI에서 값을 입력 후 JSON으로 저장해 재사용할 수 있습니다.
